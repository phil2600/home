#############
# FUNCTIONS #
#############
ur()
{
    if [ "$#" -eq 0 ]; then
        nice -n 19 unrar x *02.rar || nice -n 19 unrar x *.r01
    else
        nice -n 19 unrar x $@
    fi
}

tempwatch()
{
    while : ; do
        date "+%H:%M:%S $(sysctl hw.sensors.9|awk '{print $3}')"
        sleep 60
    done
}

viewlatex()
{
    doc=${1%%.tex}
    latex $doc.tex && latex $doc.tex && xdvi $doc.pdf
    rm -f $doc.(dvi|aux|log|toc)
}

removeallspaces()
{
    find . -maxdepth 1 ! -name .| while read name; do
    noname=${name##*/}
    ext=${noname##*.}
    [[ $noname == ${noname// /} ]] && continue
    if [[ $ext == $noname ]]; then
        namecap=${(C)noname}
    else
        noname=${noname%.*}
        namecap=${(C)noname}.$ext
    fi
    namewos=${namecap// /}
    [[ $namewos != $noname ]] &&
    [[ $namecap != $namewos ]] &&
    mv -i $name $namewos
    done
}

backup_and_edit()
{
    if [ $# -ne 1 ]; then
        echo 'What?'
        return 1
    fi
    [[ -r $1 && -f $1 ]] || {
        echo "${0##*/}: $1: no access to that file." >&2
        return 1
    }
    [ ! -r $1.orig ] && cp $1{,.orig}
    $EDITOR $1
}

uptodate()
{
    wget --no-remove-listing $1 && cat .listing && rm .listing index.html
}

lm() { ls -la "$@" | more}
mkcd()
{
    test $# -gt 0 || {
	echo 'Usage: mkcd [args] dir (see man mkdir)' >&2
	return 1
    }
    local i=0
    local dir='' # last argument = target directory
    while [ $i -lt $# ]; do
	dir="$1"
	shift
	set dummy "$@" "$dir"
	shift
	i=$((i+1))
    done
    test -d "$dir" || mkdir "$@"
    test -d "$dir" || {
	echo "mkcd: Cannot create directory $dir"
	return 1
    }
    cd "$dir"
}

top_process_running()
{
    lsof | awk '{print $1}' | sort | uniq -c | sort -rn | head
}

psg () { ps auxwww | egrep "$1|PID" | grep -v grep }
bk()      { cp -b ${1} ${1}_`date --iso-8601=m` }
cdiff()   { diff -crd "$*" | egrep -v "^Only in |^Binary files " }
cl()      { cd $1 && ls -a }        # cd && ls
disassemble(){ gcc -pipe -S -o - -O -g $* | as -aldh -o /dev/null }
# zsh with perl-regex - use it e.g. via:
# regcheck '\s\d\.\d{3}\.\d{3} Euro' ' 1.000.000 Euro'
regcheck() {
    zmodload -i zsh/pcre
    pcre_compile $1 && \
	pcre_match $2 && echo "regex matches" || echo "regex does not match"
}
# list files which have been modified within the last x days
new() { print -l *(m-$1) }

status() {
    print ""
    print "Date..: "$(date "+%Y-%m-%d %H:%M:%S")""
    print "Shell.: Zsh $ZSH_VERSION (PID = $$, $SHLVL nests)"
    print "Term..: $TTY ($TERM), $BAUD bauds, $COLUMNS x $LINES cars"
    print "Login.: $LOGNAME (UID = $EUID) on $HOST"
    print "System: $(cat /etc/[A-Za-z]*[_-][rv]e[lr]*)"
    print "Uptime:$(uptime)"
    print ""
}

cp_dir_struct() {
    find * -type d -exec mkdir "$1"\{\} \;
}
lastuse() {
    last  | grep -v "^$" | awk '{ print $1 }' | sort -nr | uniq -c
}
lsTree() {
    ls -R | grep ":$" | sed -e 's/:$//' -e 's/[^-][^\/]*\//--/g' -e 's/^/   /' -e 's/-/|/'
}
lsOctal() {
    ls -l | awk '{k=0;for(i=0;i<=8;i++)k+=((substr($1,i+2,1)~/[rwx]/)*2^(8-i));if(k)printf("%0o ",k);print}'
}

give_random_pie()
{
    fB_src="/home/phil/utils/freeB_machines"
    fB_nb=$(cat $fB_src | wc -l)
    rdm_host_nb=$[ ( $RANDOM % ${fB_nb} ) ]
    rdm_host=$(cat ${fB_src} | head -n $rdm_host_nb |tail -1)
    echo "$rdm_host"
}

cpie()
{
    host=`give_random_pie`
    echo "ssh on $host"

    ssh faure_p@ssh.epita.fr -t ssh $host
}

cass()
{
    ssh faure_p@ssh.epita.fr -t ssh acu.epita.fr
}

epoch2real(){
    perl -le 'print scalar localtime ${1}'
}


## ALIAS ##
###########
alias ds='dig +noauthority +noadditional +noqr +nostats +noidentify +nocmd +noquestion +nocomments'
alias firefox_destroyer='ps aux|grep [f]irefox|awk '{ print $2}'|xargs kill -9'

alias l="$lsbin $LS_OPTIONS"
alias ls="$lsbin $LS_OPTIONS"
alias ll="$lsbin $LS_OPTIONS -l"
alias la="$lsbin $LS_OPTIONS -la"
alias gmake="gmake --no-print-directory"
alias sl="ssh root@localhost"
sr()
{
    ssh root@${1}
}

runsr(){
    for i in apl sh lisp caml ruby ada php java asp; echo $i && ssh root@${i} -t $1 && echo
}

test_ns(){
    {
	for i in apl sh lisp caml ruby ada php java asp; \
	    echo $i && \
	    ssh root@${i} -t 'echo -n "local: " && \
who | grep -v pts | cut -d" " -f1 | sort && echo -n "netsoul: " && \
netstat -lapute --inet | grep ns | grep netsoul | sed "s/ESTABLISHED//" |tr -s " " | cut -d" " -f6' && \
	    echo
    } 2> /dev/null
}

alias zl="xscreensaver -nosplash & xscreensaver-command -lock"
alias news="emacs -f gnus"

alias web="firefox &!"
alias su='sudo su'
alias gh="echo 'corrected gh to fg'; fg"
alias diff='diff -u'
alias grep='grep --color=auto'
alias finger='MALLOC_OPTIONS='' finger'

alias psa='ps aux'
alias psu='ps  ux'

alias dfk='df -PTak'
alias dfm='df -PTam'
alias dfh='df -PTah'
alias rm='rm -i'
alias dfi='df -PTai'

#alias topten='du -sk $(l\s -A) | sort -rn | head -10'
topmax(){
    du --max-depth=1 | sort -r -n | awk '{split("k m g",v); s=1; while($1>1024){$1/=1024; s++} print int($1)" "v[s]"\t"$2}'
}
topten(){
    topmax | head -10
}


# List only directories and symbolic
# links that point to directories
alias lsd='ls -ld *(-/DN)'
# List only file beginning with "."
alias lsa='ls -ld .*'
alias lstoday='ls *(m-1)'
alias lsempty='ls -ld **/*(/^F)'
alias filldisk='watch -n 1 df'
alias df='df -P'
alias topfiles="watch --differences -n 5 'df; ls -FlAt;'"
alias toptenprocess='ps aux | sort -nk +4 | tail'
# Xterm resizing-fu.
# Based on http://svn.kitenet.net/trunk/home-full/.zshrc?rev=11710&view=log (by Joey Hess)
alias hide='echo -en "\033]50;nil2\007"'
alias tiny='echo -en "\033]50;-misc-fixed-medium-r-normal-*-*-80-*-*-c-*-iso8859-15\007"'
alias small='echo -en "\033]50;6x10\007"'
alias medium='echo -en "\033]50;-misc-fixed-medium-r-normal--13-120-75-75-c-80-iso8859-15\007"'
alias default='echo -e "\033]50;-misc-fixed-medium-r-normal-*-*-140-*-*-c-*-iso8859-15\007"'
alias large='echo -en "\033]50;-misc-fixed-medium-r-normal-*-*-150-*-*-c-*-iso8859-15\007"'
alias huge='echo -en "\033]50;-misc-fixed-medium-r-normal-*-*-210-*-*-c-*-iso8859-15\007"'
alias smartfont='echo -en "\033]50;-artwiz-smoothansi-*-*-*-*-*-*-*-*-*-*-*-*\007"'
alias semifont='echo -en "\033]50;-misc-fixed-medium-r-semicondensed-*-*-120-*-*-*-*-iso8859-15\007"'

alias lsw='ls -ld *(R,W,X.^ND/)'       # world-{readable,writable,executable} files
alias lsbig="ls -flh *(.OL[1,10])"     # display the biggest files
alias lsd='ls -d *(/)'                 # only show directories
alias lse='ls -d *(/^F)'               # only show empty directories
alias lsnew="ls -rl *(D.om[1,10])"     # display the newest files
alias lsold="ls -rtlh *(D.om[1,10])"   # display the oldest files
alias lssmall="ls -Srl *(.oL[1,10])"   # display the smallest files
